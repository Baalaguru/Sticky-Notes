<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Notes Editor</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN"
      crossorigin="anonymous"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.2/font/bootstrap-icons.min.css"
    />
    <style>
      #add-notes-btn {
        width: 150px;
        height: 50px;
        font-weight: bold;
        border-width: 3px;
      }
    </style>
  </head>
  <body>
    <br /><br />
    <header class="container-fluid text-center">
      <section>
        <!-- Button trigger modal -->
        <button
          type="button"
          class="btn btn-outline-warning"
          id="add-notes-btn"
          data-bs-toggle="modal"
          data-bs-target="#exampleModal"
        >
          <i class="bi bi-file-earmark-plus-fill"></i>
          <span>Add a Note</span>
        </button>
      </section>
    </header>
    <!-- notes view -->
    <div
      id="notes-view"
      class="row row-cols-1 row-cols-md-4 g-4 mx-5 mb-5"
    ></div>
    <!-- <div class="col">
        <div class="card text-center">
          <div class="card-header">Featured</div>
          <div class="card-body">
            <h5 class="card-title">Special title treatment</h5>
            <p>
              with supporting text below as a natural lead-in to additional
              content.
            </p>
            <a href="#" class="btn btn-primary px-4 mt-5">view</a>
          </div>
          <div class="card-footer text-muted">2 days ago</div>
        </div> -->

    <!-- <div class="col">
        <div class="card text-center">
          <div class="card-header">Featured</div>
          <div class="card-body">
            <h5 class="card-title">Special title treatment</h5>
            <p class="card-text">
              With supporting text below as a natural lead-in to additional
              content.
            </p>
            <a href="#" class="btn btn-primary">Go somewhere</a>
          </div>
          <div class="card-footer text-muted">2 days ago</div>
        </div>
      </div>
      <div class="col">
        <div class="card text-center">
          <div class="card-header">Featured</div>
          <div class="card-body">
            <h5 class="card-title">Special title treatment</h5>
            <p class="card-text">
              With supporting text below as a natural lead-in to additional
              content.
            </p>
            <a href="#" class="btn btn-primary">Go somewhere</a>
          </div>
          <div class="card-footer text-muted">2 days ago</div>
        </div>
      </div> -->

    <!-- Add Note Modal -->
    <div
      class="modal fade"
      id="exampleModal"
      tabindex="-1"
      aria-labelledby="exampleModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h1 class="modal-title fs-5" id="exampleModalLabel">
              Add a new note
            </h1>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body">
            <div class="input-group mb-3 flex-nowrap">
              <!-- <span class="input-group-text" id="addon-wrapping">@</span> -->
              <input
                type="text"
                class="form-control"
                id="add-note-title"
                placeholder="Note Title"
                aria-label="Note Title"
                aria-describedby="addon-wrapping"
              />
            </div>
            <div class="input-group">
              <span class="input-group-text">With textarea</span>
              <textarea
                id="add-note-content"
                class="form-control"
                aria-label="With textarea"
                rows="5"
              ></textarea>
            </div>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
            >
              Close
            </button>
            <button type="button" class="btn btn-primary" onclick="addNote()">
              Save changes
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- view note model -->

    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
      crossorigin="anonymous"
    ></script>
    <script>
      // window.addEventListener("DOMContentLoaded", function () {
      let idb = indexedDB.open("notes-editor", 1);
      idb.onupgradeneeded = () => {
        let res = idb.result;
        res.createObjectStore("notes", { autoIncrement: true });
      };
      idb.onsuccess = () => {
        let res = idb.result;
        let tx = res.transaction("notes", "readonly");
        let store = tx.objectStore("notes");
        let cursor = store.openCursor();
        let noteCard = "";
        cursor.onsuccess = () => {
          let notes = cursor.result;

          if (notes) {
            noteCard += `<div class="col">
                <div class="card text-center">

                      <div class="card-body">
                          <h5 class="card-title">${notes.value.Title}</h5>
                          <p>
                            ${notes.value.Content}
                          </p>
                          <a href="#" class="btn btn-primary px-4 mt-4 onclick="viewNote(${notes.key})">view</a>
                      </div>
                  <div class="card-footer text-muted">${notes.value.DateTime}</div>
             </div>`;
            document.getElementById("notes-view").innerHTML = noteCard;
            notes.continue();
          }
        };
      };
      // });
      let addNote = () => {
        let newTitle = document.getElementById("add-note-title").value;
        let newContent = document.getElementById("add-note-content").value;
        let date = new Date();
        var newDateTime = date.toLocaleString();

        let idb = indexedDB.open("notes-editor", 1);

        idb.onupgradeneeded = () => {
          let res = idb.result;
          res.createObjectStore("notes", { autoIncrement: true });
        };

        idb.onsuccess = () => {
          let res = idb.result;
          let tx = res.transaction("notes", "readwrite");
          let store = tx.objectStore("notes");

          store.put({
            Title: newTitle,
            Content: newContent,
            DateTime: newDateTime,
          });
        };
        location.reload();
      };
      let viewNote = (key) => {
        let idb = indexedDB.open("notes-editor", 1);
      idb.onupgradeneeded = () => {
        let res = idb.result;
        res.createObjectStore("notes", { autoIncrement: true });
      };
      idb.onsuccess = () => {
        let res = idb.result;
        let tx = res.transaction("notes", "readonly");
        let store = tx.objectStore("notes");
        note.onsuccess = () =>{
          console.log("note.result")
        }

      };
    </script>
  </body>
</html>
